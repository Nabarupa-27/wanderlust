<% layout('layouts/boilerplate') %>

  <% let selectedCategory=typeof category !=="undefined" ? category : null; %>
    <%= success %>

      <!-- AIRBNB STYLE CATEGORY BAR -->
      <div class="airbnb-top-bar">
        <div class="airbnb-categories">

          <a href="/listings" class="cat <%= !selectedCategory ? 'active' : '' %>">
            <i class="fa-solid fa-fire"></i>
            <span>Trending</span>
          </a>

          <a href="/listings?category=rooms" class="cat <%= selectedCategory === 'rooms' ? 'active' : '' %>">
            <i class="fa-solid fa-bed"></i>
            <span>Rooms</span>
          </a>

          <a href="/listings?category=iconic" class="cat <%= selectedCategory === 'iconic' ? 'active' : '' %>">
            <i class="fa-solid fa-city"></i>
            <span>Iconic Cities</span>
          </a>

          <a href="/listings?category=mountains" class="cat <%= selectedCategory === 'mountains' ? 'active' : '' %>">
            <i class="fa-solid fa-mountain"></i>
            <span>Mountains</span>
          </a>

          <a href="/listings?category=camping" class="cat <%= selectedCategory === 'camping' ? 'active' : '' %>">
            <i class="fa-solid fa-campground"></i>
            <span>Camping</span>
          </a>

          <a href="/listings?category=farms" class="cat <%= selectedCategory === 'farms' ? 'active' : '' %>">
            <i class="fa-solid fa-tractor"></i>
            <span>Farms</span>
          </a>

          <a href="/listings?category=arctic" class="cat <%= selectedCategory === 'arctic' ? 'active' : '' %>">
            <i class="fa-solid fa-igloo"></i>
            <span>Arctic</span>
          </a>

          <a href="/listings?category=domes" class="cat <%= selectedCategory === 'domes' ? 'active' : '' %>">
            <i class="fa-solid fa-house-dome"></i>
            <span>Domes</span>
          </a>

          <a href="/listings?category=boats" class="cat <%= selectedCategory === 'boats' ? 'active' : '' %>">
            <i class="fa-solid fa-sailboat"></i>
            <span>Boats</span>
          </a>

        </div>

        <div class="tax-toggle">
          <span>Display total after taxes</span>
          <label class="switch">
            <input type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <!-- LISTINGS GRID -->
      <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 g-4">

        <% for (let listing of allListings) { %>

          <div class="col">
            <div class="card position-relative h-100">

              <!-- Wishlist Heart -->
              <% if (currentUser) { %>
                <a href="/listings/<%= listing._id %>/wishlist" class="wishlist-heart-btn">
                  <% const saved=currentUser.wishlist && currentUser.wishlist.some( w=> w.toString() ===
                    listing._id.toString()
                    );
                    %>

                    <% if (saved) { %>
                      <i class="fa-solid fa-heart text-danger"></i>
                      <% } else { %>
                        <i class="fa-regular fa-heart"></i>
                        <% } %>
                </a>
                <% } %>

                  <!-- Listing Link -->
                  <a href="/listings/<%= listing._id %>" class="listing-link text-decoration-none text-dark">
                    <img src="<%= listing.image.url %>" class="card-img-top" alt="listing_image" />

                    <div class="card-body">
                      <p class="card-text">
                        <%= listing.title %><br />
                          â‚¹ <%= listing.price.toLocaleString("en-IN") %> / night
                      </p>
                    </div>
                  </a>

            </div>
          </div>

          <% } %>

      </div>